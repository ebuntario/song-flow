{
  "meta": {
    "project": "SongFlow TikTok Song Requests Platform",
    "date": "2026-01-31",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "SongFlow is a real-time music engagement platform that integrates TikTok Live chat with Spotify playback to enable streamers in Indonesia to receive, manage, and play song requests via TikTok Live interactions. It provides a seamless experience linking TikTok authentication with Spotify control, delivering an interactive overlay for streamers to enhance viewer engagement and monetize their live streams.",
  "core_goals": [
    "Enable TikTok Live streamers to authenticate via TikTok OAuth.",
    "Allow streamers to connect their Spotify accounts to control music playback.",
    "Provide real-time listening to TikTok Live chat and parse song request commands.",
    "Queue requested songs on Spotify and display live now playing and queue updates.",
    "Offer a responsive dashboard for managing live sessions, queue, and user settings.",
    "Implement rate limiting and content filtering to maintain quality and prevent abuse.",
    "Support an overlay view for broadcasters to show now playing and upcoming songs in streaming software.",
    "Secure user data and comply with privacy laws including encryption of sensitive tokens.",
    "Provide analytics on song requests, top requesters, and session engagement metrics.",
    "Offer freemium and premium tiers with advanced features like VIP prioritization and skip voting."
  ],
  "key_features": [
    "TikTok OAuth Authentication with NextAuth.js for primary login.",
    "Spotify OAuth Integration to link music accounts for playback control.",
    "Live Session Panel to start/stop and monitor song request sessions.",
    "Real-time WebSocket communication enabling dashboard and overlay sync.",
    "Song Request Processing including command parsing, Spotify search, and queuing.",
    "Rate limiting per user and session to prevent spam requests.",
    "Content filtering including explicit content toggle, banned words and user bans.",
    "Dashboard UI offering now playing, queue list, request settings, and analytics.",
    "Overlay view with customizable themes and real-time updates for broadcasting.",
    "Security measures including encrypted token storage, HTTPS/WSS, and scoped access.",
    "Comprehensive API endpoints for sessions, requests, Spotify actions, analytics, and settings."
  ],
  "user_flow_summary": [
    "User visits the site and clicks 'Sign in with TikTok', authenticating via TikTok OAuth.",
    "After authentication, user is redirected to dashboard to connect Spotify account via OAuth.",
    "User starts a live session from the dashboard, which connects to TikTok Live chat via WebSocket.",
    "Viewers send song request commands in TikTok Live chat (e.g., '!lagu Shape of You').",
    "System parses commands, searches Spotify, and queues the track to user's Spotify playback device.",
    "Dashboard updates in real-time showing now playing track, queue, and session metrics.",
    "Streamer can control playback via dashboard (skip tracks, reorder queue).",
    "Overlay displays current and upcoming songs to viewers in live stream via a browser source.",
    "Streamer configures request settings such as rate limits, content filters, and bans.",
    "Analytics of session are recorded and available to streamer post-session."
  ],
  "validation_criteria": [
    "Successful TikTok OAuth login flow with redirect to dashboard.",
    "Spotify OAuth linking correctly reflects in dashboard and enables playback control.",
    "Live session starts and connects to TikTok Live chat WebSocket reliably.",
    "Song request commands from TikTok Live chat are parsed and valid tracks queued on Spotify.",
    "Dashboard and overlay receive real-time updates with <2 second latency.",
    "Rate limiting blocks excessive requests with user feedback messages.",
    "Explicit content and banned user filters prevent unwanted songs from queuing.",
    "Overlay customization options function and reflect changes immediately.",
    "Session and song request analytics data are accurate and accessible.",
    "Security protocols such as token encryption, HTTPS, and role-based access control are enforced.",
    "API endpoints respond appropriately to requests and handle errors gracefully."
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Next.js 14",
      "React 18",
      "NextAuth.js (Auth.js v5)",
      "Drizzle ORM",
      "Neon PostgreSQL",
      "TailwindCSS",
      "Radix UI",
      "Playwright"
    ],
    "features": [
      {
        "name": "TikTok OAuth Authentication",
        "description": "Primary login method using TikTok OAuth. Users authenticate with their TikTok account to access the application. Redirects to /dashboard on success.",
        "files": [
          "src/auth.ts",
          "src/app/(auth)/login/page.tsx",
          "src/app/api/auth/[...nextauth]/route.ts"
        ]
      },
      {
        "name": "Spotify OAuth Linking",
        "description": "Secondary OAuth provider to link Spotify account for music playback. Required for enabling song requests feature. Users connect after logging in with TikTok.",
        "files": [
          "src/auth.ts",
          "src/app/dashboard/page.tsx",
          "src/lib/spotify/client.ts"
        ]
      },
      {
        "name": "Dashboard",
        "description": "Main application view after authentication. Shows user profile, Spotify connection status, and live session panel. Protected route requiring authentication.",
        "files": [
          "src/app/dashboard/page.tsx",
          "src/components/live-session-panel.tsx",
          "src/components/session-controls.tsx"
        ]
      },
      {
        "name": "Live Session Panel",
        "description": "Component for managing TikTok Live song request sessions. Allows starting/stopping sessions and viewing song queue.",
        "files": [
          "src/components/live-session-panel.tsx",
          "src/components/session-controls.tsx"
        ]
      },
      {
        "name": "Song Queue API",
        "description": "API endpoint for managing song request queue during live sessions.",
        "files": [
          "src/app/api/queue/route.ts"
        ]
      },
      {
        "name": "Session API",
        "description": "API endpoint for managing live streaming sessions.",
        "files": [
          "src/app/api/session/route.ts"
        ]
      },
      {
        "name": "Terms of Service Page",
        "description": "Legal page displaying terms of service for the application.",
        "files": [
          "src/app/tos/page.tsx"
        ]
      },
      {
        "name": "Privacy Policy Page",
        "description": "Legal page displaying privacy policy for the application.",
        "files": [
          "src/app/policy/page.tsx"
        ]
      },
      {
        "name": "UI Components",
        "description": "Reusable UI components built with Radix UI primitives and styled with TailwindCSS.",
        "files": [
          "src/components/ui/button.tsx",
          "src/components/ui/card.tsx",
          "src/components/ui/dialog.tsx",
          "src/components/ui/dropdown-menu.tsx",
          "src/components/ui/separator.tsx",
          "src/components/ui/toast.tsx",
          "src/components/ui/toaster.tsx"
        ]
      }
    ]
  }
}
